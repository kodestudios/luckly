<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Conectando Discord…</title>
</head>
<body>
Conectando Discord…

<script type="module">
const params = new URLSearchParams(location.hash.slice(1));
const accessToken = params.get("access_token");

if (!accessToken) {
  document.body.innerText = "Error: token no recibido";
  throw new Error("No token");
}

// Pedir datos públicos a Discord
const user = await fetch("https://discord.com/api/users/@me", {
  headers: { Authorization: `Bearer ${accessToken}` }
}).then(r => r.json());

// Construir avatar CDN
const avatar = user.avatar
  ? `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.gif`
  : "";

// Guardar TEMPORALMENTE (NO token)
localStorage.setItem("discord_pending", JSON.stringify({
  id: user.id,
  username: user.username,
  discriminator: user.discriminator,
  avatar
}));

// Volver al dashboard
location.href = "dashboard.html";
</script>
</body>
</html>
